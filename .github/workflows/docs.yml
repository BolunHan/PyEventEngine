name: Documentation

on:
    push:
        tags:
            - 'v*.*.*'  # Trigger on version tags like v0.4.3, v1.0.0, etc.
    pull_request:
        branches: [ main, master ]
    workflow_dispatch:  # Allow manual triggering

permissions:
    contents: write

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest

        steps:
            -   name: Checkout code
                uses: actions/checkout@v4
                with:
                    fetch-depth: 0  # Fetch all history for proper version detection

            -   name: Set up Python
                uses: actions/setup-python@v5
                with:
                    python-version: '3.12'

            -   name: Install dependencies
                run: |
                    python -m pip install --upgrade pip
                    pip install sphinx furo
                    pip install -e .  # Install package for autodoc

            -   name: Build documentation
                run: |
                    cd docs
                    sphinx-build -M html . _build

            -   name: Deploy to GitHub Pages
                # Deploy on push to main/master or on version tags
                if: github.event_name == 'push' && (github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master' || startsWith(github.ref, 'refs/tags/v')) || github.event_name == 'workflow_dispatch'
                uses: peaceiris/actions-gh-pages@v3
                with:
                    github_token: ${{ secrets.GITHUB_TOKEN }}
                    publish_dir: ./docs/_build/html
                    cname: false  # Set to your custom domain if you have one
                    commit_message: 'Deploy documentation for ${{ github.ref_name }}'

